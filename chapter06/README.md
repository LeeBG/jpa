# Chapter 06. 다양한 연관관계 매핑

이번 장에서는 다양한 연관관계를 다룬다. 그 전에 앞 장의 내용을 정리해보자.

- 다중성
- 단방향, 양방향
- 연관관계의 주인



먼저 연관관계가 있는 두 엔티티가 일대일 관계인지 일대다 관계인지 다중성을 고려해야 한다.
다음으로 두 엔티티 중 한쪽만 참조하는 단방향 관계인지 서로 참조하는 양방향 관계인지 고려해야 한다.
마지막으로 양방향 관계면 연관관계의 주인을 정해야 한다.

- **다중성**

  연관관계에는 다음과 같은 다중성이 있다.

  - 다대일<sup>@ManyToOne</sup>
  - 일대다<sup>@OneToMany</sup>
  - 일대일<sup>@OneToOne</sup>
  - 다대다<sup>@ManyToMany</sup>

  다중 성을 판단하기 어려울 떄는 반대방향을 생각해보면 된다. 참고로 일대다의 반대방향은 항상 다대일이고,
  일대일의 반대방향은 항상 일대일이다.
  보통 다대일과 일대다 관계를 가장 많이 사용하고 다대다 관계는 실무에서 거의 사용하지 않는다.

- **단방향, 양방향**

  테이블은 외래 키 하나로 조인을 사용해서 양방향으로 쿼리가 가능하므로 사실상 방향이라는 개념이 없다.
  반면에 객체는 참조용 필드를 가지고 있는 객체만 연관된 객체를 조회할 수 있다.
  객체 관계에서 한 쪽만 참조하는 것을 단방향 관계라 하고, 양쪽이 서로 참조하는 것을 양방향 관계라고 한다.

- **연관관계의 주인**

  테이블의 연관관계를 관리하는 포인트는 외래 키 하나다. 반면에 엔티티를 양방향으로 매핑하면 A → B, B → A 2곳에서
  서로 참조한다. 따라서 객체의 연관관계를 관리하는 포인트는 2곳이다.

  JPA는 두 객체 연관관계 중 하나를 정해서 데이터베이스 외래 키를 관리하는데 이것을 연관관계의 주인이라 한다.
  따라서 A → B 또는 B → A 둘 중 하나를 정해서 외래 키를 관리해야 한다.
  외래 키를 가진 테이블과 매핑한 엔티티가 외래 키를 관리하는게 효율적이므로 보통 이곳을 연관관계의 주인으로 선택한다.
  주인이 아닌 방향은 외래 키를 변경할 수 없고 읽기만 가능하다.

  연관관계의 주인은 mappedBy 속성을 사용하지 않는다. 연관관계의 주인이 아니면 mappedBy 속성을 사용하고
  연관관계의 주인 필드 이름을 값으로 입력해야 한다.



지금부터 다중성과 단방향, 양방향을 고려한 가능한 모든 연관관계를 하나씩 알아보자.

- 다대일: 단방향, 양방향
- 일대다: 단방향, 양방향
- 일대일: 주 테이블 단방향, 양방향
- 일대일: 대상 테이블 단방향, 양방향
- 다대다: 단방향, 양방향

참고로 다중성은 왼쪽을 연관관계의 주인으로 정했다. 다대일 양방향이라 하면 다<sup>N</sup>가 연관관계의 주인이다.



## 6.1 다대일

다대일 관계의 반대 방향은 항상 일대다 관계고 일대다 관계의 반대 방향은 항상 다대일 관계다.
데이터베이스 테이블의 일, 다 관계에서 외래키는 항상 다쪽에 있다. 따라서 객체 양방향 관계에서 연관관계의 주인은 항상
다쪽이다. 예를들어 회원<sup>N</sup>과 팀<sup>1</sup>이 있으면 회원 쪽이 연관관계의 주인이다.



### 6.1.1 다대일 단방향 [N:1]

회원, 팀 엔티티 코드를 통해 다대일 단방향 연관관계를 알아보자.



